(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0a513d"],{"08ba":function(s,t,a){"use strict";a.r(t);var n=function(){var s=this,t=s.$createElement;s._self._c;return s._m(0)},l=[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h3",{attrs:{id:"vue-router%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-router%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"}}),s._v(" Vue Router源码分析")]),a("h5",{attrs:{id:"vue-router-%E6%98%AF%E4%B8%80%E4%B8%AA%E6%8F%92%E4%BB%B6-%E9%9C%80%E8%A6%81%E7%94%A8%E5%88%B0-vue.use()-%E6%8C%82%E8%BD%BD-%E9%A6%96%E5%85%88%E5%88%86%E6%9E%90%E4%B8%80%E4%B8%8B-vue.use"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-router-%E6%98%AF%E4%B8%80%E4%B8%AA%E6%8F%92%E4%BB%B6-%E9%9C%80%E8%A6%81%E7%94%A8%E5%88%B0-vue.use()-%E6%8C%82%E8%BD%BD-%E9%A6%96%E5%85%88%E5%88%86%E6%9E%90%E4%B8%80%E4%B8%8B-vue.use"}}),s._v(" Vue Router 是一个插件 需要用到 vue.use() 挂载 首先分析一下 vue.use")]),a("p",[s._v("源码位置：vue/src/core/global-api/use.js")]),a("pre",{staticClass:"hljs"},[a("code",[a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("initUse")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("Vue: GlobalAPI")]),s._v(") ")]),s._v("{\n  Vue.use = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("plugin: Function | Object")]),s._v(") ")]),s._v("{\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 维护了一个 _installedPlugins 数组，它存储所有注册过的 plugin")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" installedPlugins = ("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("._installedPlugins || ("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("._installedPlugins = []))\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 防止重复注册")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (installedPlugins.indexOf(plugin) > "),a("span",{staticClass:"hljs-number"},[s._v("-1")]),s._v(") {\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("\n    }\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 附加参数 一般为[]")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" args = toArray("),a("span",{staticClass:"hljs-built_in"},[s._v("arguments")]),s._v(", "),a("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(")\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 第一个参数是 Vue")]),s._v("\n    args.unshift("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(")\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 每个插件都需要实现一个静态的 install 方法")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("typeof")]),s._v(" plugin.install === "),a("span",{staticClass:"hljs-string"},[s._v("'function'")]),s._v(") {\n      plugin.install.apply(plugin, args)\n    } "),a("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("typeof")]),s._v(" plugin === "),a("span",{staticClass:"hljs-string"},[s._v("'function'")]),s._v(") {\n      plugin.apply("),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(", args)\n    }\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 添加缓存")]),s._v("\n    installedPlugins.push(plugin)\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("\n  }\n}\n")])]),a("h5",{attrs:{id:"%E8%B7%AF%E7%94%B1%E5%AE%89%E8%A3%85"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E8%B7%AF%E7%94%B1%E5%AE%89%E8%A3%85"}}),s._v(" 路由安装")]),a("p",[s._v("源码位置：vue/src/core/global-api/use.js")]),a("pre",{staticClass:"hljs"},[a("code",[a("span",{staticClass:"hljs-comment"},[s._v("// Vue-Router 的入口文件是 src/index.js其中定义了 VueRouter 类，")]),s._v("\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 也实现了 install 的静态方法：VueRouter.install = install，")]),s._v("\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 它的定义在 src/install.js 中。")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" _Vue\n"),a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("install")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("Vue")]),s._v(") ")]),s._v("{\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 确保install() 只执行一次")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (install.installed && _Vue === Vue) "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v("\n  install.installed = "),a("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v("\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 全局的 _Vue 来接收参数 Vue，因为作为 Vue 的插件对 Vue 对象是有依赖的")]),s._v("\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 但又不能去单独去 import Vue，因为那样会增加包体积，")]),s._v("\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 所以就通过这种方式拿到 Vue 对象。")]),s._v("\n  _Vue = Vue\n\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" isDef = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("v")]),s._v(" =>")]),s._v(" v !== "),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v("\n\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" registerInstance = "),a("span",{staticClass:"hljs-function"},[s._v("("),a("span",{staticClass:"hljs-params"},[s._v("vm, callVal")]),s._v(") =>")]),s._v(" {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" i = vm.$options._parentVnode\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (isDef(i) && isDef(i = i.data) && isDef(i = i.registerRouteInstance)) {\n      i(vm, callVal)\n    }\n  }\n\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// Vue-Router 安装最重要的一步就是利用")]),s._v("\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// Vue.mixin 去把 beforeCreate 和 destroyed 钩子函数注入到每一个组件中")]),s._v("\n  Vue.mixin({\n    beforeCreate () {\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (isDef("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".$options.router)) {\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// 表示Vue自身")]),s._v("\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("._routerRoot = "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// 表示vueRouter实例")]),s._v("\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("._router = "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".$options.router\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// 初始化 vueRouter")]),s._v("\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("._router.init("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(")\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// this._route 变成响应式对象")]),s._v("\n        Vue.util.defineReactive("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", "),a("span",{staticClass:"hljs-string"},[s._v("'_route'")]),s._v(", "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("._router.history.current)\n      } "),a("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" {\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("._routerRoot = ("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".$parent && "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".$parent._routerRoot) || "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("\n      }\n      registerInstance("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(")\n    },\n    destroyed () {\n      registerInstance("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(")\n    }\n  })\n  \n  "),a("span",{staticClass:"hljs-comment"},[s._v("// vue原型上定义$router、$route")]),s._v("\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 这就是为什么组件中可以访问this.$router 以及 this.$route")]),s._v("\n  "),a("span",{staticClass:"hljs-built_in"},[s._v("Object")]),s._v(".defineProperty(Vue.prototype, "),a("span",{staticClass:"hljs-string"},[s._v("'$router'")]),s._v(", {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("get")]),s._v(" () { "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("._routerRoot._router }\n  })\n\n  "),a("span",{staticClass:"hljs-built_in"},[s._v("Object")]),s._v(".defineProperty(Vue.prototype, "),a("span",{staticClass:"hljs-string"},[s._v("'$route'")]),s._v(", {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("get")]),s._v(" () { "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("._routerRoot._route }\n  })\n  \n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 挂载全局组件")]),s._v("\n  Vue.component("),a("span",{staticClass:"hljs-string"},[s._v("'RouterView'")]),s._v(", View)\n  Vue.component("),a("span",{staticClass:"hljs-string"},[s._v("'RouterLink'")]),s._v(", Link)\n\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" strats = Vue.config.optionMergeStrategies\n  strats.beforeRouteEnter = strats.beforeRouteLeave = strats.beforeRouteUpdate = strats.created\n}\n")])]),a("h5",{attrs:{id:"vuerouter-%E5%AF%B9%E8%B1%A1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vuerouter-%E5%AF%B9%E8%B1%A1"}}),s._v(" VueRouter 对象")]),a("pre",{staticClass:"hljs"},[a("code",[a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(" "),a("span",{staticClass:"hljs-class"},[a("span",{staticClass:"hljs-keyword"},[s._v("class")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("VueRouter")]),s._v(" ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("static")]),s._v(" install: "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("()")]),s._v(" =>")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("void")]),s._v(";\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("static")]),s._v(" version: string;\n\n  app: any;\n  apps: "),a("span",{staticClass:"hljs-built_in"},[s._v("Array")]),s._v("<any>;\n  ready: boolean;\n  readyCbs: "),a("span",{staticClass:"hljs-built_in"},[s._v("Array")]),s._v("<"),a("span",{staticClass:"hljs-built_in"},[s._v("Function")]),s._v(">;\n  options: RouterOptions;\n  mode: string;\n  history: HashHistory | HTML5History | AbstractHistory;\n  matcher: Matcher;\n  fallback: boolean;\n  beforeHooks: "),a("span",{staticClass:"hljs-built_in"},[s._v("Array")]),s._v("<?NavigationGuard>;\n  resolveHooks: "),a("span",{staticClass:"hljs-built_in"},[s._v("Array")]),s._v("<?NavigationGuard>;\n  afterHooks: "),a("span",{staticClass:"hljs-built_in"},[s._v("Array")]),s._v("<?AfterNavigationHook>;\n\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("constructor")]),s._v(" (options: RouterOptions = {}) {\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 表示根 Vue 实例")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".app = "),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v("\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 保存持有 $options.router 属性的 Vue 实例")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".apps = []\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 保存传入的路由配置")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".options = options\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 表示一些钩子函数")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".beforeHooks = []\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".resolveHooks = []\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".afterHooks = []\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 创建路由列表 【会单独分析】")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".matcher = createMatcher(options.routes || [], "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(")\n\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" mode = options.mode || "),a("span",{staticClass:"hljs-string"},[s._v("'hash'")]),s._v("\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// this.fallback 表示在浏览器不支持 history.pushState 的情况下")]),s._v("\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 根据传入的 fallback 配置参数，决定是否回退到hash模式，")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".fallback = mode === "),a("span",{staticClass:"hljs-string"},[s._v("'history'")]),s._v(" && !supportsPushState && options.fallback !== "),a("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".fallback) {\n      mode = "),a("span",{staticClass:"hljs-string"},[s._v("'hash'")]),s._v("\n    }\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (!inBrowser) {\n      mode = "),a("span",{staticClass:"hljs-string"},[s._v("'abstract'")]),s._v("\n    }\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".mode = mode\n    \n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 匹配不同路由模式")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("switch")]),s._v(" (mode) {\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("case")]),s._v(" "),a("span",{staticClass:"hljs-string"},[s._v("'history'")]),s._v(":\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".history = "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" HTML5History("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", options.base)\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("break")]),s._v("\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("case")]),s._v(" "),a("span",{staticClass:"hljs-string"},[s._v("'hash'")]),s._v(":\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".history = "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" HashHistory("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", options.base, "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".fallback)\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("break")]),s._v("\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("case")]),s._v(" "),a("span",{staticClass:"hljs-string"},[s._v("'abstract'")]),s._v(": "),a("span",{staticClass:"hljs-comment"},[s._v("// 非浏览器模式 不考虑")]),s._v("\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".history = "),a("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" AbstractHistory("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(", options.base)\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("break")]),s._v("\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(":\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (process.env.NODE_ENV !== "),a("span",{staticClass:"hljs-string"},[s._v("'production'")]),s._v(") {\n          assert("),a("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(", "),a("span",{staticClass:"hljs-string"},[s._v("`invalid mode: "),a("span",{staticClass:"hljs-subst"},[s._v("${mode}")]),s._v("`")]),s._v(")\n        }\n    }\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 初始化方法 【下面分析】")]),s._v("\n    init (app: any) {}\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// ....")]),s._v("\n  }\n}\n")])]),a("h4",{attrs:{id:"%E5%AE%9E%E4%BE%8B%E5%8C%96-vuerouter-%E5%90%8E%E4%BC%9A%E8%BF%94%E5%9B%9E%E5%AE%83%E7%9A%84%E5%AE%9E%E4%BE%8B-router%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8-new-vue-%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E6%8A%8A-router-%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E7%9A%84%E5%B1%9E%E6%80%A7%E4%BC%A0%E5%85%A5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E5%AE%9E%E4%BE%8B%E5%8C%96-vuerouter-%E5%90%8E%E4%BC%9A%E8%BF%94%E5%9B%9E%E5%AE%83%E7%9A%84%E5%AE%9E%E4%BE%8B-router%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8-new-vue-%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E6%8A%8A-router-%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E7%9A%84%E5%B1%9E%E6%80%A7%E4%BC%A0%E5%85%A5"}}),s._v(" 实例化 VueRouter 后会返回它的实例 router，我们在 new Vue 的时候会把 router 作为配置的属性传入")]),a("pre",{staticClass:"hljs"},[a("code",[s._v("beforeCreate() {\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (isDef("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".$options.router)) {\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// ...")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("._router = "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".$options.router\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v("._router.init("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(")\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// ...")]),s._v("\n  }\n} \n")])]),a("h5",{attrs:{id:"%E5%88%86%E6%9E%90-init"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E5%88%86%E6%9E%90-init"}}),s._v(" 分析 init")]),a("pre",{staticClass:"hljs"},[a("code",[s._v("init (app: any) {\n  process.env.NODE_ENV !== "),a("span",{staticClass:"hljs-string"},[s._v("'production'")]),s._v(" && assert(\n    install.installed,\n    "),a("span",{staticClass:"hljs-string"},[s._v("`not installed. Make sure to call \\`Vue.use(VueRouter)\\` `")]),s._v(" +\n    "),a("span",{staticClass:"hljs-string"},[s._v("`before creating root instance.`")]),s._v("\n  )\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 当前vue")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".apps.push(app)\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 避免重复  ")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".app) {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v("\n  }\n\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".app = app\n\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" history = "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".history\n \n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 拿到当前的 this.history，根据它的不同类型来执行不同逻辑，")]),s._v("\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 由于我们平时使用 hash 路由多一些，所以我们先看这部分逻辑，")]),s._v("\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 先定义了 setupHashListener 函数，接着执行了 history.transitionTo 方法")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (history "),a("span",{staticClass:"hljs-keyword"},[s._v("instanceof")]),s._v(" HTML5History) {\n    history.transitionTo(history.getCurrentLocation())\n  } "),a("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (history "),a("span",{staticClass:"hljs-keyword"},[s._v("instanceof")]),s._v(" HashHistory) {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" setupHashListener = "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("()")]),s._v(" =>")]),s._v(" {\n      history.setupListeners()\n    }\n    history.transitionTo(\n      history.getCurrentLocation(),\n      setupHashListener,\n      setupHashListener\n    )\n  }\n\n  history.listen("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("route")]),s._v(" =>")]),s._v(" {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".apps.forEach("),a("span",{staticClass:"hljs-function"},[s._v("("),a("span",{staticClass:"hljs-params"},[s._v("app")]),s._v(") =>")]),s._v(" {\n      app._route = route\n    })\n  })\n}\n")])]),a("h5",{attrs:{id:"history.transitionto"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#history.transitionto"}}),s._v(" history.transitionTo")]),a("p",[s._v("源码地址：src/history/base.js")]),a("pre",{staticClass:"hljs"},[a("code",[s._v("transitionTo (location: RawLocation, onComplete?: "),a("span",{staticClass:"hljs-built_in"},[s._v("Function")]),s._v(", onAbort?: "),a("span",{staticClass:"hljs-built_in"},[s._v("Function")]),s._v(") {\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" route = "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".router.match(location, "),a("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".current)\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// ...")]),s._v("\n}\n")])]),a("h5",{attrs:{id:"%E6%88%91%E4%BB%AC%E5%85%88%E4%B8%8D%E7%9D%80%E6%80%A5%E5%8E%BB%E7%9C%8B-transitionto-%E7%9A%84%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%EF%BC%8C%E5%85%88%E7%9C%8B%E7%AC%AC%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81%EF%BC%8C"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E6%88%91%E4%BB%AC%E5%85%88%E4%B8%8D%E7%9D%80%E6%80%A5%E5%8E%BB%E7%9C%8B-transitionto-%E7%9A%84%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%EF%BC%8C%E5%85%88%E7%9C%8B%E7%AC%AC%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81%EF%BC%8C"}}),s._v(" 我们先不着急去看 transitionTo 的具体实现，先看第一行代码，")]),a("h5",{attrs:{id:"%E5%AE%83%E8%B0%83%E7%94%A8%E4%BA%86-this.router.match-%E5%87%BD%E6%95%B0%2C%E5%AE%83%E6%98%AF%E5%9C%A8creatematcher%E5%87%BD%E6%95%B0%E4%B8%AD%E8%B0%83%E7%94%A8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E5%AE%83%E8%B0%83%E7%94%A8%E4%BA%86-this.router.match-%E5%87%BD%E6%95%B0%2C%E5%AE%83%E6%98%AF%E5%9C%A8creatematcher%E5%87%BD%E6%95%B0%E4%B8%AD%E8%B0%83%E7%94%A8"}}),s._v(" 它调用了 this.router.match 函数,它是在createMatcher函数中调用")]),a("pre",{staticClass:"hljs"},[a("code",[a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" { pathList, pathMap, nameMap } = createRouteMap(routes)\n    "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("addRoutes")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("routes")]),s._v(") ")]),s._v("{\n    createRouteMap(routes, pathList, pathMap, nameMap)\n    }\n    "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("createRouteMap")]),s._v(" ("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{} "),a("span",{staticClass:"hljs-comment"},[s._v("// 单独分析")]),s._v("\n    "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("match")]),s._v(" ("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{} "),a("span",{staticClass:"hljs-comment"},[s._v("// 单独分析")]),s._v("\n    "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("_createRoute")]),s._v(" ("),a("span",{staticClass:"hljs-params"}),s._v(") ")]),s._v("{} "),a("span",{staticClass:"hljs-comment"},[s._v("// 单独分析")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" {\n      match,\n      addRoutes\n    }\n")])]),a("h5",{attrs:{id:"createroutemap-%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E8%B7%AF%E7%94%B1%E6%98%A0%E5%B0%84%E8%A1%A8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#createroutemap-%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E8%B7%AF%E7%94%B1%E6%98%A0%E5%B0%84%E8%A1%A8"}}),s._v(" createRouteMap 定义一个路由映射表")]),a("pre",{staticClass:"hljs"},[a("code",[a("span",{staticClass:"hljs-comment"},[s._v("// 可以创建路由映射表，也可以动态添加")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("createRouteMap")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("\n  routes: Array<RouteConfig>,\n  oldPathList?: Array<string>,\n  oldPathMap?: Dictionary<RouteRecord>,\n  oldNameMap?: Dictionary<RouteRecord>\n")]),s._v("): ")]),s._v("{\n  pathList: "),a("span",{staticClass:"hljs-built_in"},[s._v("Array")]),s._v("<string>;\n  pathMap: Dictionary<RouteRecord>;\n  nameMap: Dictionary<RouteRecord>;\n} {\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" pathList: "),a("span",{staticClass:"hljs-built_in"},[s._v("Array")]),s._v("<string> = oldPathList || []\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" pathMap: Dictionary<RouteRecord> = oldPathMap || "),a("span",{staticClass:"hljs-built_in"},[s._v("Object")]),s._v(".create("),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(")\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" nameMap: Dictionary<RouteRecord> = oldNameMap || "),a("span",{staticClass:"hljs-built_in"},[s._v("Object")]),s._v(".create("),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(")\n   \n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 遍历router列表")]),s._v("\n    "),a("span",{staticClass:"hljs-comment"},[s._v("/* const routes = [\n      { path: '/foo', component: Foo },\n      { path: '/bar', component: Bar }\n    ] */")]),s._v("\n  routes.forEach("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("route")]),s._v(" =>")]),s._v(" {\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 根据参数生成一条记录 如果有子节点循环调用生成树结构的记录")]),s._v("\n    addRouteRecord(pathList, pathMap, nameMap, route)\n  })\n  \n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 匹配通配符    ")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" i = "),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v(", l = pathList.length; i < l; i++) {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (pathList[i] === "),a("span",{staticClass:"hljs-string"},[s._v("'*'")]),s._v(") {\n      pathList.push(pathList.splice(i, "),a("span",{staticClass:"hljs-number"},[s._v("1")]),s._v(")["),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("])\n      l--\n      i--\n    }\n  }\n\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" {\n    pathList, "),a("span",{staticClass:"hljs-comment"},[s._v("// 存储所有的 path存储所有的 path")]),s._v("\n    pathMap, "),a("span",{staticClass:"hljs-comment"},[s._v("// 表示一个 path 到 RouteRecord 的映射关系")]),s._v("\n    nameMap "),a("span",{staticClass:"hljs-comment"},[s._v("// name 到 RouteRecord 的映射关系")]),s._v("\n  }\n}\n")])]),a("h5",{attrs:{id:"match"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#match"}}),s._v(" match")]),a("pre",{staticClass:"hljs"},[a("code",[a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("match")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("\n  raw: RawLocation, "),a("span",{staticClass:"hljs-regexp"},[s._v("//")]),s._v(" 是 RawLocation 类型，它可以是一个 url 字符串，也可以是一个 Location 对象\n  currentRoute?: Route, "),a("span",{staticClass:"hljs-regexp"},[s._v("//")]),s._v(" 是 Route 类型，它表示当前的路径\n  redirectedFrom?: Location "),a("span",{staticClass:"hljs-regexp"},[s._v("//")]),s._v(" 和重定向相关\n")]),s._v("): "),a("span",{staticClass:"hljs-title"},[s._v("Route")]),s._v(" ")]),s._v("{\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 方法的作用是根据 raw，current 计算出新的 location")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" location = normalizeLocation(raw, currentRoute, "),a("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(", router)\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" { name } = location\n\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (name) {\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 匹配到 record")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" record = nameMap[name]\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (process.env.NODE_ENV !== "),a("span",{staticClass:"hljs-string"},[s._v("'production'")]),s._v(") {\n      warn(record, "),a("span",{staticClass:"hljs-string"},[s._v("`Route with name '"),a("span",{staticClass:"hljs-subst"},[s._v("${name}")]),s._v("' does not exist`")]),s._v(")\n    }\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 失败 创建一个空的 record")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (!record) "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" _createRoute("),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(", location)\n   "),a("span",{staticClass:"hljs-comment"},[s._v("// 然后拿到 record 对应的 paramNames，再对比 currentRoute 中的 params，")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" paramNames = record.regex.keys\n      .filter("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("key")]),s._v(" =>")]),s._v(" !key.optional)\n      .map("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-params"},[s._v("key")]),s._v(" =>")]),s._v(" key.name)\n\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("typeof")]),s._v(" location.params !== "),a("span",{staticClass:"hljs-string"},[s._v("'object'")]),s._v(") {\n      location.params = {}\n    }\n     "),a("span",{staticClass:"hljs-comment"},[s._v("// 把交集部分的 params 添加到 location 中，")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (currentRoute && "),a("span",{staticClass:"hljs-keyword"},[s._v("typeof")]),s._v(" currentRoute.params === "),a("span",{staticClass:"hljs-string"},[s._v("'object'")]),s._v(") {\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" key "),a("span",{staticClass:"hljs-keyword"},[s._v("in")]),s._v(" currentRoute.params) {\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (!(key "),a("span",{staticClass:"hljs-keyword"},[s._v("in")]),s._v(" location.params) && paramNames.indexOf(key) > "),a("span",{staticClass:"hljs-number"},[s._v("-1")]),s._v(") {\n          location.params[key] = currentRoute.params[key]\n        }\n      }\n    }\n       "),a("span",{staticClass:"hljs-comment"},[s._v("// 然后在通过 fillParams 方法根据 record.path 和 location.path 计算出 location.path，")]),s._v("\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (record) {\n      location.path = fillParams(record.path, location.params, "),a("span",{staticClass:"hljs-string"},[s._v('`named route "'),a("span",{staticClass:"hljs-subst"},[s._v("${name}")]),s._v('"`')]),s._v(")\n      "),a("span",{staticClass:"hljs-comment"},[s._v("// 最后调用 _createRoute(record, location, redirectedFrom) 去生成一条新路径，")]),s._v("\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" _createRoute(record, location, redirectedFrom)\n    }\n  } "),a("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (location.path) {\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 通过 name 我们可以很快的找到 record，但是通过 path 并不能，")]),s._v("\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 因为我们计算后的 location.path 是一个真实路径，")]),s._v("\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 而 record 中的 path 可能会有 param，因此需要对所有的 pathList 做顺序遍历，")]),s._v("\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// 然后通过 matchRoute 方法根据 record.regex、location.path、location.params 匹配，")]),s._v("\n    location.params = {}\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" i = "),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("; i < pathList.length; i++) {\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" path = pathList[i]\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" record = pathMap[path]\n      "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (matchRoute(record.regex, location.path, location.params)) {\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" _createRoute(record, location, redirectedFrom)\n      }\n    }\n  }\n  \n  "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" _createRoute("),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(", location)\n}\n")])]),a("h5",{attrs:{id:"_createroute"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_createroute"}}),s._v(" _createRoute")]),a("pre",{staticClass:"hljs"},[a("code",[a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("_createRoute")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("\n  record: ?RouteRecord,\n  location: Location,\n  redirectedFrom?: Location\n")]),s._v("): "),a("span",{staticClass:"hljs-title"},[s._v("Route")]),s._v(" ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (record && record.redirect) {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" redirect(record, redirectedFrom || location)\n  }\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (record && record.matchAs) {\n    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" alias(record, location, record.matchAs)\n  }\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" createRoute(record, location, redirectedFrom, router)\n}\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 我们先不考虑 record.redirect 和 record.matchAs 的情况，")]),s._v("\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 最终会调用 createRoute 方法")]),s._v("\n"),a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("createRoute")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("\n  record: ?RouteRecord,\n  location: Location,\n  redirectedFrom?: ?Location,\n  router?: VueRouter\n")]),s._v("): "),a("span",{staticClass:"hljs-title"},[s._v("Route")]),s._v(" ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" stringifyQuery = router && router.options.stringifyQuery\n\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" query: any = location.query || {}\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("try")]),s._v(" {\n    query = clone(query)\n  } "),a("span",{staticClass:"hljs-keyword"},[s._v("catch")]),s._v(" (e) {}\n  \n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 最终返回的是一条 Route 路径，")]),s._v("\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 在 Vue-Router 中，所有的 Route 最终都会通过 createRoute 函数创建，")]),s._v("\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 并且它最后是不可以被外部修改的。Route 对象中有一个非常重要属性是 matched，")]),s._v("\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// 它通过 formatMatch(record) 计算而来：")]),s._v("\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" route: Route = {\n    "),a("span",{staticClass:"hljs-attr"},[s._v("name")]),s._v(": location.name || (record && record.name),\n    "),a("span",{staticClass:"hljs-attr"},[s._v("meta")]),s._v(": (record && record.meta) || {},\n    "),a("span",{staticClass:"hljs-attr"},[s._v("path")]),s._v(": location.path || "),a("span",{staticClass:"hljs-string"},[s._v("'/'")]),s._v(",\n    "),a("span",{staticClass:"hljs-attr"},[s._v("hash")]),s._v(": location.hash || "),a("span",{staticClass:"hljs-string"},[s._v("''")]),s._v(",\n    query,\n    "),a("span",{staticClass:"hljs-attr"},[s._v("params")]),s._v(": location.params || {},\n    "),a("span",{staticClass:"hljs-attr"},[s._v("fullPath")]),s._v(": getFullPath(location, stringifyQuery),\n    "),a("span",{staticClass:"hljs-attr"},[s._v("matched")]),s._v(": record ? formatMatch(record) : []\n  }\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (redirectedFrom) {\n    route.redirectedFrom = getFullPath(redirectedFrom, stringifyQuery)\n  }\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-built_in"},[s._v("Object")]),s._v(".freeze(route)\n}\n")])]),a("h5",{attrs:{id:"formatmatch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#formatmatch"}}),s._v(" formatMatch")]),a("pre",{staticClass:"hljs"},[a("code",[a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("formatMatch")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("record: ?RouteRecord")]),s._v("): "),a("span",{staticClass:"hljs-title"},[s._v("Array")]),s._v("<"),a("span",{staticClass:"hljs-title"},[s._v("RouteRecord")]),s._v("> ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" res = []\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("while")]),s._v(" (record) {\n    res.unshift(record)\n    record = record.parent\n  }\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" res\n}\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 可以看它是通过 record 循环向上找 parent，直到找到最外层，")]),s._v("\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 并把所有的 record 都 push 到一个数组中，最终返回的就是 record 的数组，")]),s._v("\n"),a("span",{staticClass:"hljs-comment"},[s._v("// 它记录了一条线路上的所有 record。matched 属性非常有用，它为之后渲染组件提供了依据")]),s._v("\n")])])])}],e=a("2877"),i={},r=Object(e["a"])(i,n,l,!1,null,null,null);t["default"]=r.exports}}]);